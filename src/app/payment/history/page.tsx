import { auth } from "@/auth";
import { db } from "@/server/db";
import React from "react";
import Link from "next/link";
import styles from "./history.module.scss";
import NavBar from "@/components/molecules/navbar/navbar";
import { redirect } from 'next/navigation'

const PaymentHistoryPage = async () => {
    const session = await auth();

    if (!session?.user?.id) {
        return redirect('/')
    }

    if (!session?.user?.id) {
        return (
            <div className={styles["payment-history"]}>
                <p>You must be logged in to view your payment history.</p>
                <Link href="/login">Go to Login</Link>
            </div>
        );
    }

    const payments = await db.payment.findMany({
        where: { userId: session.user.id },
        orderBy: { createdAt: "desc" },
    });

    const formatDate = (date: Date) => {
        return date.toLocaleDateString("en-GB", {
            day: "2-digit",
            month: "long",
            year: "2-digit",
        });
    };

    const formatTime = (date: Date) => {
        return date
            .toLocaleTimeString("en-GB", {
                hour: "2-digit",
                minute: "2-digit",
                hour12: true,
            })
            .replace(":", ".");
    };

    return (
        <div className={styles.wraper}>
            <NavBar />
            <div className={styles.container}>
                <div className={styles.header}>
                    <h1 className={styles.title}>
                        Payment History
                    </h1>
                </div>

                <div className={styles.paymentwraper}>
                    {payments.length === 0 ? (
                        <p className={styles["no-payments"]}>No payments found.</p>
                    ) : (
                        <div className={styles.table}>
                            {payments.map((payment) => (
                                <div className={styles.tablecontainer} key={payment.id}>
                                    <div className={styles.tableinfo} >
                                        {payment.plan === 'pro' &&
                                            <img className={styles.banner} src="https://i.pinimg.com/736x/26/75/b3/2675b3aae8f8f764a012dc6aea7992c9.jpg" />
                                        }

                                        <div className={styles.paymentinfo}>

                                            <div className={styles.paymentdirectory}>
                                                <div className={styles.status}>
                                                    {payment.status === 'paid' &&
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="13" height="16" viewBox="0 0 16 16" fill="none">
                                                            <path fillRule="evenodd" clipRule="evenodd" d="M8 16C10.1217 16 12.1566 15.1571 13.6569 13.6569C15.1571 12.1566 16 10.1217 16 8C16 5.87827 15.1571 3.84344 13.6569 2.34315C12.1566 0.842855 10.1217 0 8 0C5.87827 0 3.84344 0.842855 2.34315 2.34315C0.842855 3.84344 0 5.87827 0 8C0 10.1217 0.842855 12.1566 2.34315 13.6569C3.84344 15.1571 5.87827 16 8 16ZM11.857 6.191C11.9149 6.11129 11.9566 6.02095 11.9796 5.92514C12.0026 5.82933 12.0065 5.72994 11.991 5.63262C11.9756 5.5353 11.9412 5.44198 11.8897 5.35797C11.8382 5.27396 11.7707 5.20091 11.691 5.143C11.6113 5.08509 11.5209 5.04344 11.4251 5.02044C11.3293 4.99744 11.2299 4.99354 11.1326 5.00895C11.0353 5.02437 10.942 5.0588 10.858 5.11028C10.774 5.16176 10.7009 5.22929 10.643 5.309L7.16 10.099L5.28 8.219C5.21078 8.1474 5.128 8.0903 5.03647 8.05104C4.94495 8.01178 4.84653 7.99114 4.74694 7.99032C4.64736 7.9895 4.54861 8.00852 4.45646 8.04628C4.3643 8.08403 4.28059 8.13976 4.2102 8.21021C4.13982 8.28066 4.08417 8.36443 4.0465 8.45662C4.00883 8.54881 3.9899 8.64758 3.99081 8.74716C3.99173 8.84674 4.01246 8.94515 4.05181 9.03663C4.09116 9.12812 4.14834 9.21085 4.22 9.28L6.72 11.78C6.79663 11.8567 6.88896 11.9158 6.99065 11.9534C7.09233 11.9909 7.20094 12.006 7.30901 11.9975C7.41708 11.9891 7.52203 11.9573 7.61663 11.9044C7.71123 11.8515 7.79324 11.7787 7.857 11.691L11.857 6.191Z" fill="#34A853" />
                                                        </svg>
                                                    }

                                                    {payment.status === 'created' &&
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="13" height="16" viewBox="0 0 16 16" fill="none">
                                                            <path fillRule="evenodd" clipRule="evenodd" d="M8 16C10.1217 16 12.1566 15.1571 13.6569 13.6569C15.1571 12.1566 16 10.1217 16 8C16 5.87827 15.1571 3.84344 13.6569 2.34315C12.1566 0.842855 10.1217 0 8 0C5.87827 0 3.84344 0.842855 2.34315 2.34315C0.842855 3.84344 0 5.87827 0 8C0 10.1217 0.842855 12.1566 2.34315 13.6569C3.84344 15.1571 5.87827 16 8 16ZM6.28 5.22C6.13782 5.08752 5.94978 5.0154 5.75548 5.01883C5.56118 5.02225 5.37579 5.10097 5.23838 5.23838C5.10097 5.37579 5.02225 5.56118 5.01883 5.75548C5.0154 5.94978 5.08752 6.13782 5.22 6.28L6.94 8L5.22 9.72C5.14631 9.78866 5.08721 9.87146 5.04622 9.96346C5.00523 10.0555 4.98319 10.1548 4.98141 10.2555C4.97963 10.3562 4.99816 10.4562 5.03588 10.5496C5.0736 10.643 5.12974 10.7278 5.20096 10.799C5.27218 10.8703 5.35701 10.9264 5.4504 10.9641C5.54379 11.0018 5.64382 11.0204 5.74452 11.0186C5.84523 11.0168 5.94454 10.9948 6.03654 10.9538C6.12854 10.9128 6.21134 10.8537 6.28 10.78L8 9.06L9.72 10.78C9.78866 10.8537 9.87146 10.9128 9.96346 10.9538C10.0555 10.9948 10.1548 11.0168 10.2555 11.0186C10.3562 11.0204 10.4562 11.0018 10.5496 10.9641C10.643 10.9264 10.7278 10.8703 10.799 10.799C10.8703 10.7278 10.9264 10.643 10.9641 10.5496C11.0018 10.4562 11.0204 10.3562 11.0186 10.2555C11.0168 10.1548 10.9948 10.0555 10.9538 9.96346C10.9128 9.87146 10.8537 9.78866 10.78 9.72L9.06 8L10.78 6.28C10.9125 6.13782 10.9846 5.94978 10.9812 5.75548C10.9777 5.56118 10.899 5.37579 10.7616 5.23838C10.6242 5.10097 10.4388 5.02225 10.2445 5.01883C10.0502 5.0154 9.86218 5.08752 9.72 5.22L8 6.94L6.28 5.22Z" fill="#EF3A3A" />
                                                        </svg>
                                                    }

                                                    <p className={styles.paymentstatus}>
                                                        {payment.status === 'paid' && 'Paid'}
                                                        {payment.status === 'created' && 'Failed'}
                                                    </p>
                                                </div>

                                                <h2 className={styles.plan}>
                                                    {payment.plan === 'pro' &&
                                                        'Orbit Pro'
                                                    }
                                                </h2>

                                                <div className={styles.timing}>
                                                    <h3 className={styles.time}>{formatTime(payment.createdAt)}</h3>
                                                    <h3 className={styles.date}>{formatDate(payment.createdAt)}</h3>
                                                </div>

                                            </div>

                                            <h3 className={styles.price}>
                                                <span className={styles.rupee}>â‚¹</span>
                                                {(payment.amount / 100).toFixed(2)}
                                            </h3>
                                        </div>

                                    </div>
                                    <div className={styles.moreinfo}>
                                        <h2 className={styles.id}>
                                            <span className={styles.label}>
                                                Order ID
                                            </span>
                                            {payment.razorpayOrderId}
                                        </h2>
                                        <h2 className={styles.id}>
                                            <span className={styles.label}>
                                                Payment ID
                                            </span>
                                            {payment.razorpayPaymentId || "Not Available"}
                                        </h2>
                                    </div>
                                </div>
                            ))}
                        </div>

                    )}
                </div>

                <div className={styles.attributes}>
                    <div className={styles.credits}>
                        <p className={styles.label}>Powered by</p>
                        <svg xmlns="http://www.w3.org/2000/svg" height={20} viewBox="0 0 190 41" className={styles.logo}>
                            <path fillRule="evenodd" clipRule="evenodd" d="M45.2732 15.1766C44.9736 16.2942 44.3931 17.1145 43.5315 17.6382C42.6688 18.1619 41.4589 18.4242 39.8984 18.4242H34.9403L36.6808 11.9295H41.6389C43.1983 11.9295 44.2689 12.1914 44.8505 12.715C45.4311 13.2392 45.5727 14.0596 45.2732 15.1766ZM50.4077 15.0367C51.0382 12.6866 50.7768 10.8822 49.624 9.62527C48.4709 8.36832 46.4506 7.7402 43.5651 7.7402H32.4973L25.836 32.5987H31.2131L33.8988 22.5783H37.4251C38.2158 22.5783 38.8383 22.7065 39.2935 22.9626C39.7497 23.2191 40.0168 23.6731 40.0992 24.324L41.0583 32.5987H46.8198L45.8851 24.8831C45.6946 23.1605 44.9063 22.148 43.521 21.8456C45.2871 21.334 46.7664 20.4835 47.9577 19.2963C49.1479 18.1097 49.9653 16.6901 50.4077 15.0367Z" />
                            <path fillRule="evenodd" clipRule="evenodd" d="M63.4762 23.6957C63.0269 25.3712 62.3347 26.6519 61.4001 27.5361C60.4643 28.4209 59.3449 28.8628 58.0422 28.8628C56.7138 28.8628 55.8128 28.4267 55.3378 27.5536C54.8606 26.681 54.8443 25.4188 55.2879 23.7654C55.7303 22.1131 56.4363 20.8214 57.4081 19.8895C58.3788 18.9595 59.5156 18.4933 60.8194 18.4933C62.1223 18.4933 63.0047 18.9421 63.4622 19.8379C63.9198 20.7337 63.9255 22.0196 63.4762 23.6957ZM65.8332 14.8973L65.1598 17.4112C64.8683 16.5032 64.3052 15.7821 63.4715 15.2468C62.6367 14.7116 61.6021 14.4433 60.3689 14.4433C58.856 14.4433 57.4011 14.8335 56.0055 15.6132C54.6098 16.3934 53.3894 17.493 52.3457 18.9125C51.3018 20.3325 50.5366 21.95 50.05 23.7654C49.5636 25.5814 49.466 27.1815 49.7586 28.5661C50.0512 29.9513 50.6852 31.0161 51.6616 31.7609C52.6371 32.5063 53.8934 32.8779 55.4296 32.8779C56.6627 32.8779 57.8378 32.6219 58.9525 32.1098C60.0671 31.5984 61.0134 30.8878 61.7925 29.9803L61.0901 32.5987H66.2918L71.0351 14.8973H65.8332Z" />
                            <path fillRule="evenodd" clipRule="evenodd" d="M89.7397 14.8974H74.6219L73.5652 18.843H82.363L70.7309 28.8977L69.7381 32.5988H85.3449L86.4026 28.6538H76.9767L88.7853 18.4586L89.7397 14.8974Z" />
                            <path fillRule="evenodd" clipRule="evenodd" d="M103.05 23.6611C102.582 25.4062 101.889 26.7107 100.971 27.5718C100.054 28.4327 98.944 28.8629 97.6412 28.8629C94.9172 28.8629 94.0208 27.1299 94.9497 23.6611C95.4118 21.9385 96.1085 20.641 97.0398 19.7684C97.972 18.8952 99.1007 18.4587 100.428 18.4587C101.731 18.4587 102.61 18.8952 103.063 19.7684C103.515 20.641 103.512 21.9385 103.05 23.6611ZM106.093 15.5605C104.896 14.8161 103.367 14.4435 101.504 14.4435C99.6186 14.4435 97.8722 14.8161 96.2642 15.5605C94.656 16.3059 93.2869 17.3765 92.1572 18.7727C91.0262 20.1695 90.2111 21.7986 89.7118 23.6611C89.2125 25.5235 89.1545 27.152 89.5377 28.5488C89.9197 29.9456 90.7139 31.0162 91.9238 31.7611C93.1326 32.5065 94.6791 32.8781 96.5649 32.8781C98.4272 32.8781 100.156 32.5065 101.753 31.7611C103.347 31.0162 104.711 29.9456 105.842 28.5488C106.972 27.152 107.787 25.5235 108.286 23.6611C108.786 21.7986 108.844 20.1695 108.462 18.7727C108.079 17.3765 107.289 16.3059 106.093 15.5605Z" />
                            <path fillRule="evenodd" clipRule="evenodd" d="M160.501 23.6957C160.052 25.3712 159.36 26.6519 158.425 27.5361C157.49 28.4209 156.369 28.8628 155.066 28.8628C153.74 28.8628 152.838 28.4267 152.363 27.5536C151.885 26.681 151.869 25.4188 152.313 23.7654C152.755 22.1131 153.461 20.8214 154.433 19.8895C155.404 18.9595 156.541 18.4933 157.844 18.4933C159.147 18.4933 160.03 18.9421 160.487 19.8379C160.945 20.7337 160.95 22.0196 160.501 23.6957ZM162.858 14.8973L162.185 17.4112C161.893 16.5032 161.33 15.7821 160.496 15.2468C159.662 14.7116 158.627 14.4433 157.394 14.4433C155.881 14.4433 154.426 14.8335 153.03 15.6132C151.635 16.3934 150.414 17.493 149.371 18.9125C148.327 20.3325 147.561 21.95 147.075 23.7654C146.589 25.5814 146.492 27.1815 146.784 28.5661C147.076 29.9513 147.709 31.0161 148.687 31.7609C149.662 32.5063 150.918 32.8779 152.455 32.8779C153.688 32.8779 154.863 32.6219 155.977 32.1098C157.092 31.5984 158.038 30.8878 158.817 29.9803L158.115 32.5987H163.317L168.06 14.8973H162.858Z" />
                            <path fillRule="evenodd" clipRule="evenodd" d="M124.64 19.6457L125.966 14.8276C125.515 14.5948 124.918 14.4782 124.174 14.4782C122.986 14.4782 121.843 14.7748 120.741 15.3687C119.794 15.8782 118.989 16.5934 118.308 17.4895L118.998 14.8948L117.492 14.8973H113.798L109.018 32.5986H114.292L116.771 23.3469C117.132 21.9971 117.78 20.9439 118.717 20.1874C119.652 19.431 120.818 19.0524 122.215 19.0524C123.077 19.0524 123.884 19.2503 124.64 19.6457Z" />
                            <path fillRule="evenodd" clipRule="evenodd" d="M139.319 23.7651C138.876 25.4186 138.188 26.6808 137.257 27.5533C136.324 28.4265 135.206 28.8625 133.904 28.8625C132.6 28.8625 131.712 28.4207 131.239 27.5359C130.765 26.6517 130.754 25.3715 131.203 23.6954C131.652 22.0194 132.351 20.7334 133.301 19.8376C134.251 18.9418 135.378 18.493 136.682 18.493C137.962 18.493 138.832 18.9592 139.292 19.8899C139.752 20.8211 139.762 22.1134 139.319 23.7651ZM143.005 15.6128C142.026 14.8331 140.78 14.4436 139.268 14.4436C137.941 14.4436 136.678 14.7461 135.482 15.3511C134.282 15.9572 133.31 16.7821 132.565 17.83L132.582 17.7139L133.468 14.8946H132.448V14.8971H128.32L127.009 19.792C126.994 19.8489 126.981 19.902 126.966 19.9595L121.559 40.14H126.831L129.554 29.9807C129.821 30.8875 130.376 31.5981 131.217 32.1096C132.058 32.6216 133.094 32.8777 134.329 32.8777C135.865 32.8777 137.326 32.5061 138.713 31.7607C140.1 31.0163 141.305 29.951 142.327 28.5658C143.349 27.1818 144.104 25.5811 144.591 23.7651C145.077 21.9497 145.178 20.3323 144.896 18.9122C144.614 17.4927 143.982 16.3931 143.005 15.6128Z" />
                            <path fillRule="evenodd" clipRule="evenodd" d="M189.894 14.9023L189.897 14.8974H186.704C186.601 14.8974 186.511 14.9003 186.418 14.9023H184.76L183.913 16.0832C183.845 16.1722 183.777 16.2617 183.704 16.3656L183.612 16.5024L176.875 25.884L175.478 14.8974H169.961L172.755 31.5921L166.584 40.1403H172.082L173.577 38.0219C173.621 37.9588 173.659 37.9071 173.706 37.8404L189.889 14.9096L189.897 14.9023H189.894Z" />
                            <path fillRule="evenodd" clipRule="evenodd" d="M12.2854 10.588L10.707 16.3967L19.7388 10.5554L13.8323 32.5932L19.8303 32.5987L28.5557 0.0483398L12.2854 10.588Z" />
                            <path fillRule="evenodd" clipRule="evenodd" d="M2.56408 23.3343L0.0809326 32.5987H12.3756C12.3756 32.5987 17.4044 13.7566 17.4058 13.7512C17.4011 13.7542 2.56408 23.3343 2.56408 23.3343Z" />
                        </svg>
                    </div>
                </div>
            </div>

        </div>

    );
};

export default PaymentHistoryPage;
